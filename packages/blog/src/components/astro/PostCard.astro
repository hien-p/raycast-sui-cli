---
interface Props {
  title: string;
  description: string;
  publishDate: Date;
  category: 'announcement' | 'tutorial' | 'wrapup' | 'guide';
  slug: string;
  heroImage?: string;
  selected?: boolean;
  index?: number;
}

const {
  title,
  description,
  publishDate,
  category,
  slug,
  heroImage,
  selected = false,
  index = 0,
} = Astro.props;

const categoryStyles = {
  announcement: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
  tutorial: 'bg-green-500/20 text-green-400 border-green-500/30',
  wrapup: 'bg-purple-500/20 text-purple-400 border-purple-500/30',
  guide: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
};

const formattedDate = publishDate.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

// Calculate read time (rough estimate: 200 words per minute)
const readTime = Math.ceil(description.split(' ').length / 40) + 2;
---

<a
  href={`/blog/posts/${slug}`}
  class="block group"
  style={`animation-delay: ${index * 100}ms`}
>
  <article
    class:list={[
      'relative p-4 rounded-xl border transition-all duration-200',
      'bg-black/70 hover:bg-black/80 shadow-lg',
      selected
        ? 'border-l-2 border-l-primary border-white/20'
        : 'border-white/10 hover:border-white/20',
    ]}
  >
    <!-- Terminal-style header -->
    <div class="flex items-center gap-3 mb-3 font-mono text-sm">
      <!-- Selection indicator -->
      <span class:list={[
        'text-xs font-bold transition-opacity',
        selected ? 'text-primary opacity-100' : 'opacity-0 group-hover:opacity-50',
      ]}>
        &gt;
      </span>

      <!-- Filename -->
      <span class="text-white/70 group-hover:text-white transition-colors">
        {slug}.mdx
      </span>

      <!-- Category tag -->
      <span class:list={['tag', categoryStyles[category]]}>
        [{category}]
      </span>
    </div>

    <!-- Title -->
    <h3 class="text-lg font-semibold text-white mb-2 pl-6 group-hover:text-primary transition-colors drop-shadow-md">
      {title}
    </h3>

    <!-- Description -->
    <p class="text-white/70 text-sm pl-6 mb-4 line-clamp-2">
      {description}
    </p>

    <!-- Meta info -->
    <div class="flex items-center gap-2 pl-6 text-xs text-white/30 font-mono">
      <span class="text-white/15">━━━━━━━━━━━━━━</span>
      <time datetime={publishDate.toISOString()}>{formattedDate}</time>
      <span>·</span>
      <span>{readTime} min read</span>
    </div>

    <!-- Hero image preview (if available) -->
    {heroImage && (
      <div class="mt-4 ml-6 rounded-lg overflow-hidden border border-white/10">
        <img
          src={heroImage}
          alt={title}
          class="w-full h-32 object-cover opacity-70 group-hover:opacity-100 transition-opacity"
          loading="lazy"
        />
      </div>
    )}
  </article>
</a>

<style>
  @keyframes fadeSlideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  a {
    animation: fadeSlideIn 0.4s ease-out forwards;
    opacity: 0;
  }
</style>
